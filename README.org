* KSP Reviva

KSP Reviva is the IVA Revival!

** For Players

If you like flying in first-person from the in-vehicle crewed cockpit, either in stock or
using [[https://forum.kerbalspaceprogram.com/index.php?/topic/190737-18x-112x-rasterpropmonitor-adopted/][RPM]] and/or [[https://forum.kerbalspaceprogram.com/index.php?/topic/160856-wip-111x-moardvs-avionics-systems-mas-interactive-iva-v123-21-may-2021/][MAS,]] then this mod is for you.

Features:

- Allow switching of IVA from stock to different alternates (if needed mods are loaded) using
  [[https://forum.kerbalspaceprogram.com/index.php?/topic/140541-1112-b9partswitch-v2180-march-17/][B9PartSwitch]].
  
  - This can be done from the editor, and the settings are saved with the ship design.
  - This can *also* be done live from flight! Use the PAW right-click menu on the
    command module when not in IVA (yup, not realistic, but this is KSP). This allows for the
    player to load this mod on existing saves and change IVAs on already flying craft, or
    to try out different IVA.
  - Without Reviva, only the "last" IVA mod for each command module would be available.

- Links together stock and modded IVA into one place and provides limited patches to
  ensure they work in 1.12.x.
  
  - Note that this mod doesn't include the IVAs, but provides links for recommended or
    optional IVA mods, plus patches to allow them to run and be switched dynamically.

- Very low overhead on performance: command modules get an extra IVASwitchPart, and switch
  detection only happens when changes are made.

- The different IVA selection does not change the characteristics, mass, cost or other
  data on the actual command pod: it's all visual for IVA. This means you can change at
  any time without penalty, by design.
  
** For Modders

You can provide multiple IVAs for your modded crewed command modules: this might allow for
an empty (low resource) IVA and a more complex (heavy resource) IVA as an option, or tech
level upgrades from lower tech to higher tech (using B9PartSwitch part upgrades).

The only requirement is that there are seperately named INTERNAL definitions for each
selection. Module Manager is your friend, see the provided examples in Reviva and follow
the pattern.

- If Reviva already has support for the command module mod and provides other IVAs, it is
  preferable that additional SUBTYPE are added to the standard IVASwitch Module provided
  by Reviva.
- If there's no existing support in Reviva, you should copy the similar part style whole for
  Reviva itself in your own mod (eg. Stock/mk1Cockpit.cfg).
- You could alternatively clone Reviva and make changes there and push them, or if you're
  really lazy ask me to do it.

Feel free to ask questions in the forum, I'm not super experienced with KSP modding, but I
know game development well enough to be dangerous/helpful.

* Installation

** Required Mods

For Reviva to be enabled there's a mimimum set of required mods (and their dependencies):

- Reviva - obviously, but this provides a small DLL that remembers the IVA selection and
  handles switching the IVA dynamically in the editor or in flight.
- [[https://forum.kerbalspaceprogram.com/index.php?/topic/140541-1112-b9partswitch-v2180-march-17/][B9PartSwitch]] - this provides the main mechanism to define and switch IVA definitions.

** Recommended and Optional Mods

The following table shows recommended mods and optional mods that can be installed to
provide non-stock IVAs for stock and other mods. Some of these provide additional IVA for
other mods, and some only provide a single IVA (in which case Reviva is merely providing
links and/or patches to ensure they work when installed).

This table hopefully links to all the known functional (ie. for command/flying) IVA mods
in existence that can work on KSP 1.12.x - if you know of more let the mod author know.


| Status      | Mod                              | Quality | For                 | Provides                                     | Link |
|-------------+----------------------------------+---------+---------------------+----------------------------------------------+------|
| Recommended | RasterPropMonitor (RPM)          | ***     | Stock               | More complex IVA than stock                  |      |
| Recommended | MOARdv's Avionics System (MAS)   | *****   | Stock               | Successor to RPM (*), includes low tech      |      |
|             |                                  |         |                     | Mk1, Mk1-3 and Mk1 Lander.                   |      |
| Recommended | DE_IVAExtension                  | ****    | Stock               | High tech IVA for all of Stock               |      |
| Recommended | ASET IVA for Making History Pods | *****   | Making History      | High tech IVA for all of Making History      |      |
| Optional    | ASET Mk1 Cockpit                 | *****   | Stock               | High tech analog Mk1 Cockpit                 |      |
| Optional    | ASET Mk1 Lander Can              | *****   | Stock               | High tech Mk1 Lander                         |      |
| Optional    | ASET Mk1-2 Command Pod           | *****   | Stock               | High tech Mk1-3 Command Pod                  |      |
| Optional    | Probe Control Room               | ***     | PBC                 | Probe control room for probes                |      |
| Optional    | Warbird Cockpits                 | *****   | Stock, SXT,         | Analog avaition cockpits for several mods    |      |
|             |                                  |         | Airplane Plus,      |                                              |      |
|             |                                  |         | Kerbonov            |                                              |      |
| Optional    | ALCOR by ASET                    | *****   | Alcor               | High tech 3-man lander capsule               |      |
| Optional    | Vexarp IVA                       | ****    | NFSpacecraft        | Near Future Spacecraft improved IVA          |      |
| Optional    | Ultimate Shuttle IVA             | ****    | Stock               | Retro and modern MK3 Cockpit IVA             |      |
| Optional    | Tundra Exploration               | ?       | TundraExploration   | With MAS has improved alternatives (?)       |      |
| Optional    | Kerbal Flying Saucers            | ?       | KerbalFlyingSaucers | With MAS has improved alternatives (?)       |      |
| Optional    | MOARdvPlus                       | ?       | MOARdvPlus          | With MAS, three BDB Kane/Sarnus IVA (Apollo) |      |
| Optional    | NiceMK                           | ?       | ?                   | ?                                            |      |
| Optional    | Falcon (?)                       | ?       | ?                   | ?                                            |      |
| Optional    | ColdwarAerospace (?)             | ?       | ?                   | ?                                            |      |

(*) You can have either RPM or MAS, or in fact both at the same time. MAS includes upgrade
scripts that render some existing RPM IVAs at a high quality and performance (in my experience).

* User Manual

Once you have installed all the mods needed, once you've restarted the game, right
clicking on supported command modules will show the PAW UI with a group called "IVA
Switch".

When in the SPH or VAB editor this will show one or more coloured box images representing
each available IVA, plus a "Select IVA" button below that if clicked displays a drop down
menu with all the possible IVA options.

When in-flight, only the "Select IVA" menu button is available: you also need to exit any
in-IVA view (press C). When changing the IVA you should see the Kerbal portraits
temporarily go to noise for a moment. You can then re-enter the IVA view with the same
crew present (hopefully, if one gets lost or changes seats, that's the price you pay for
such fast in-flight reconstruction).

With only the required mods, it's likely you'll only see a "Stock" selection on stock command
modules, which is the vanilla IVA modules. These are always the default when adding a new
stock command module, or loading a vessel for the first time after installing the mod
(yes, it will revert any existing IVA mods to stock or default setting for that mod).

For Stock and Missing History, it's best to install the "Recommended" mods shown in the
above table: these provide three or four different IVA variants (low, medium and high
tech, sometimes with an alternative high tech variant of higher quality).

You can save the selection for the ship design in the SPH/VAB editor, in which case each launch
will use that IVA selection as the new default.

For already in-flight vessels, you can change the selection (while not in the IVA), and it
will be saved along with that ship only, this includes when the ship goes on rails
(switching away to another vessel), and when saving the game.

* Support Progress

| Name               | CFG Name            | From  | IVA             | Tech   | Support Status |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk1 Cockpit        | Mark1Cockpit        | Stock | Stock           | Low    | Done           |
|                    |                     |       | RPM             | Med    | Done           |
|                    |                     |       | DE_IVAExtension | High   | Done           |
|                    |                     |       | ASET            | High   | Done           |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk1 Command Pod    | mk1pod_v2           | Stock | Stock           | Low    | Done           |
|                    |                     |       | RPM             | Med    | Done           |
|                    |                     |       | DE_IVAExtension | High   | Done           |
|                    |                     |       | Warbirds        | Low    | Done           |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk1 Inline Cockpit | Mark2Cockpit        | Stock | Stock           | Low    | Done           |
|                    |                     |       | DE_IVAExtension | High   | Done           |
|                    |                     |       | Warbirds        | Medium | Done           |
|                    |                     |       | WarbirdsSI      | Medium | Done           |
|                    |                     |       | WarbirdsRetro   | Low    | Done           |
|                    |                     |       | WarbirdsRetroSI | Low    | Done           |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk1 Lander Can     | landerCabinSmall    | Stock | Stock           | Low    | Done           |
|                    |                     |       | RPM             | Med    |                |
|                    |                     |       | DE_IVAExtension | High   |                |
|                    |                     |       | ASET            | Low    |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk1-3 Command Pod  | mk1-3pod            | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|                    |                     |       | ASET            |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk2 Cockpit        | mk2Cockpit_Standard | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk2 Inline Cockpit | mk2Cockpit_Inline   | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|                    |                     |       | Warbirds        |        |                |
|                    |                     |       | WarbirdsSI      |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk2 Lander Can     | mk2LanderCabin_v2   | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk3 Cockpit        | mk3Cockpit_Shuttle  | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| PPD-12 Cupola      | cupola              | Stock | Stock           |        |                |
|                    |                     |       | RPM             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| KV-1               | kv1Pod              | MH    | MH              |        |                |
|                    |                     |       | ASET for MH     |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| KV-2               | kv2Pod              | MH    | MH              |        |                |
|                    |                     |       | ASET for MH     |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| KV-3               | kv3Pod              | MH    | MH              |        |                |
|                    |                     |       | ASET for MH     |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Mk2 Command Pod    | Mk2Pod              | MH    | MH              |        |                |
|                    |                     |       | ASET for MH     |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| M.E.M.             | MEMLander           | MH    | MH              |        |                |
|                    |                     |       | ASET for MH     |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| Probe Control Room |                     | PCR   | PCR             |        |                |
|                    |                     |       | DE_IVAExtension |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
| ALCOR              |                     | ALCOR | ALCOR           |        |                |
|--------------------+---------------------+-------+-----------------+--------+----------------|
|                    |                     |       |                 |        |                |

* [0/1] Tasks

** TODO Check internalConfig / part for null to stop exceptions
** TODO Switching Warbirds causing errors

#+begin_example
[LOG 22:28:02.614] [Reviva] Switch IVA Mk1InlineInternalASET_WB -> mk1InlineInternal
[LOG 22:28:02.614] [Reviva] Unload in-flight IVA
[LOG 22:28:02.615] [Reviva] Refresh IVA interal model
[LOG 22:28:02.628] [Reviva] Load in-flight IVA
[LOG 22:28:02.629] [Reviva] Switch IVA mk1InlineInternal -> Mk1InlineInternalASET_WB_SI
[LOG 22:28:02.629] [Reviva] Unload in-flight IVA
[LOG 22:28:02.629] [Reviva] Refresh IVA interal model
[LOG 22:28:02.678] [Reviva] Load in-flight IVA
[LOG 22:28:02.681] [Part Mark2Cockpit] [ModuleB9PartSwitch 'IVASwitch'] Switched subtype to WarbirdsSI
[ERR 22:28:02.754] Cannot find an InternalModule of typename 'DPAI_RPM'
[ERR 22:28:02.754] Cannot find an InternalModule of typename 'DPAI_RPM'
[ERR 22:28:02.754] Cannot find an InternalModule of typename 'JSISCANsatRPM'
[ERR 22:28:02.754] Cannot find an InternalModule of typename 'JSISCANsatRPM'
[ERR 22:28:02.756] Cannot find an InternalModule of typename 'AstrogatorMenu'
[ERR 22:28:02.757] Cannot find an InternalModule of typename 'InternalVesselView'
[ERR 22:28:02.757] Cannot find an InternalModule of typename 'InternalVesselView'
[WRN 22:28:02.893] WARNING: Color entry is not formatted properly! Proper format for Colors is r,g,b{,a}
[WRN 22:28:02.921] WARNING: Vector3 entry is not formatted properly! Proper format for Vector3 is x,y,z
[ERR 22:28:02.962] [JSICallbackAnimator]: INITIALIZATION ERROR, CHECK CONFIGURATION.
[EXC 22:28:02.966] NullReferenceException: Object reference not set to an instance of an object
	JSI.CallbackAnimationSet..ctor (ConfigNode node, System.String variableName, InternalProp thisProp) (at <05eb104d0dd24f118b48a18639af1146>:0)
	JSI.JSICallbackAnimator.Start () (at <05eb104d0dd24f118b48a18639af1146>:0)
	UnityEngine.DebugLogHandler:LogException(Exception, Object)
	ModuleManager.UnityLogHandle.InterceptLogHandler:LogException(Exception, Object)
	UnityEngine.Debug:CallOverridenDebugHandler(Exception, Object)
[ERR 22:28:03.063] Cannot find an InternalModule of typename 'JSISCANsatRPM'
[ERR 22:28:03.068] Cannot find an InternalModule of typename 'InternalVesselView'
[ERR 22:28:03.068] Cannot find an InternalModule of typename 'InternalVesselView'
[ERR 22:28:03.068] Cannot find an InternalModule of typename 'EngineIgnitorRPM'
[ERR 22:28:03.069] Cannot find an InternalModule of typename 'DPAI_RPM'
[ERR 22:28:03.069] Cannot find an InternalModule of typename 'DPAI_RPM'
#+end_example

** TODO Initial selection from editor did not work (may be above)
** TODO Add switching of RPM computer with correct fields.
  - May need copy and paste.
** TODO Implement RPM Mk1 Inline
** TODO Implement DE_IVA Mk1 Inline
** TODO Hide Mk1 Inline Warbird version
  - Removing may cause issues if anyone has used this.
  - Hide it by making tech node undefined (?)
** TODO Add assembly info
  - Get version from Makefile variable
  - Makefile version is from git tag
** TODO Add license info/link (GitHub and README)
** TODO Add thanks
** TODO Add Spacedock, GitHub, CKAN and Curse download links
  - N/A if not yet avail
** TODO Add how to get support
  - Link to forum
  - Link to forum post on this subject
  - Link to GitHub issues
** TODO Add links to all mods supported
** TODO Add in-game option to allow in-flight switching
  - Default is enabled
  - If disabled, only affects career/science modes
** TODO Add support for part upgrades
  - Default to off
  - Start nodes are defined in common .cfg
    - LowTechNode :: roughly equivalent to 1950-1969
    - MediumTechNode :: roughly equivalent to 1970-1989,
    - HighTechNode :: roughly equivalent to 1990-now,
    - NearFutureTechNode :: roughly equivalent to in-development now
    - FarFutureTechNode :: sci-fi
  - Default are CTT nodes
  - Add in-game option to enable/disable
  - If enabled, only affects career/science modes
** TODO Automatically add changes to README from git
** TODO Add publish to GitHub, Spacedock, Curse, CKAN
  - Various modders have tools to help do this already
  - Auto update version from makefile
  - Git tag sets version
** TODO Add way to export README as forum post format
  - Possible to totally automate

