* KSP Reviva

KSP Reviva is the IVA Revival!

** For Players

If you like flying in first-person from the in-vehicle crewed cockpit, either in stock or
using [[https://forum.kerbalspaceprogram.com/index.php?/topic/190737-18x-112x-rasterpropmonitor-adopted/][RPM]] and/or [[https://forum.kerbalspaceprogram.com/index.php?/topic/160856-wip-111x-moardvs-avionics-systems-mas-interactive-iva-v123-21-may-2021/][MAS,]] then this mod is for you.

Features:

- Allow switching of IVA from stock to different alternates (if needed mods are loaded) using
  [[https://forum.kerbalspaceprogram.com/index.php?/topic/140541-1112-b9partswitch-v2180-march-17/][B9PartSwitch]].
  
  - This can be done from the editor, and the settings are saved with the ship design.
  - This can *also* be done live from flight! Use the PAW right-click menu on the
    command module when not in IVA (yup, not realistic, but this is KSP). This allows for the
    player to load this mod on existing saves and change IVAs on already flying craft, or
    to try out different IVA.
  - Without Reviva, only the "last" IVA mod for each command module would be available.

- Links together stock and modded IVA into one place and provides limited patches to
  ensure they work in 1.12.x.
  
  - Note that this mod doesn't include the IVAs, but provides links for recommended or
    optional IVA mods, plus patches to allow them to run and be switched dynamically.

- Very low overhead on performance: command modules get an extra ModuleIVASwitch, and switch
  detection only happens when changes are made.

- The different IVA selection does not change the characteristics, mass, cost or other
  data on the actual command pod: it's all visual for IVA. This means you can change at
  any time without penalty, by design.
  
** For Modders

You can provide multiple IVAs for your modded crewed command modules: this might allow for
an empty (low resource) IVA and a more complex (heavy resource) IVA as an option, or tech
level upgrades from lower tech to higher tech (using B9PartSwitch part upgrades).

The only requirement is that there are seperately named INTERNAL definitions for each
selection. Module Manager is your friend, see the provided examples in Reviva and follow
the pattern.

- If Reviva already has support for the command module mod and provides other IVAs, it is
  preferable that additional SUBTYPE are added to the standard ModuleIVASwitch provided
  by Reviva.
- If there's no existing support in Reviva, you should copy the similar part style whole for
  Reviva itself in your own mod (eg. Stock/mk1Cockpit.cfg).
- You could alternatively clone Reviva and make changes there and push them, or if you're
  really lazy ask me to do it.

Feel free to ask questions in the forum, I'm not super experienced with KSP modding, but I
know game development well enough to be dangerous/helpful.

* Installation

** Required Mods

For Reviva to be enabled there's a mimimum set of required mods (and their dependencies):

- Reviva :: obviously, but this provides a small DLL that remembers the IVA selection and
  handles switching the IVA dynamically in the editor or in flight.
- [[https://forum.kerbalspaceprogram.com/index.php?/topic/140541-1112-b9partswitch-v2180-march-17/][B9PartSwitch]] :: this provides mod authors with a generalized way to describe part switching.
  This is used by Reviva to switch definitions in Reviva's ModuleIVASwitch: this small DLL
  does the magic of actually switching the IVA in the editor or in-flight.
- ModuleManager :: this is pretty much always required for modded KSP. Used to provide
  configuration for Reviva and B9PartSwitch depending on what other modules you
  install.
- RasterPropMonitor :: most IVA (other than stock) use this to provide the more complex
  IVA dials and switches. Technically you could install just MAS, though this isn't well
  tested.

Note that each mod here (and below) may itself have required and optional mods (not listed
here), check each mod's link carefully, or I recommend using CKAN. You may have to allow
earlier game versions in CKAN to load older IVA mod packs.

If you only install these you'll only see the stock and some basic IVAs with
multi-function displays (MFD) provided by RasterPropMonitor, you should probably install
the recommended and optional mods to get even more. More IVA do take up memory resources,
and slow down loading.

** Recommended and Optional Mods

Recommended mods and optional mods that can be installed to provide more complex IVAs for
stock and other mods. Reviva also provides the links and possibly patches to ensure they
work when installed.

The first recommended mod (MAS) can be installed as well as RPM, it actually upgrades
most IVA to use the MAS system, and RPM is a backup. MAS also allows for much more complex
IVA and MFDs, some part and IVA mods take advantage of this.

The other recommend mods will provide enough IVA for stock KSP and the Missing History
expansion (if installed) for stock or vanilla/lightly modded games.

This table tries to link to all the known functional (ie. for command/flying) IVA mods in
existence that can work on KSP 1.12.x - if you know of more let the mod author know.

** Dependency Summary

| Status      | Mod                              | For                   | Status  | Provides                                     | Link |
|-------------+----------------------------------+-----------------------+---------+----------------------------------------------+------|
| Required    | Reviva                           | Stock                 | -       | IVA switching and 1.12.x compatibility       |      |
| Required    | B9PartSwitch                     | Stock                 | -       | General part switching mechanics             |      |
| Required    | ModuleManager                    | Stock                 | -       | Patching mod configuration                   |      |
| Required    | RasterPropMonitor (RPM)          | Stock                 | Done    | More complex IVA than stock, includes IVA    |      |
| Recommended | MOARdv's Avionics System (MAS)   | Stock                 | Done    | Successor to RPM (1), includes low tech      |      |
|             |                                  |                       |         | Mk1, Mk1-3 and Mk1 Lander.                   |      |
| Recommended | DE_IVAExtension                  | Stock                 | Done    | High tech IVA for all of Stock               |      |
| Recommended | ASET IVA for Making History Pods | Making History        | Planned | High tech IVA for all of Making History      |      |
| Optional    | ASET Mk1 Cockpit                 | Stock                 | Done    | High tech analog Mk1 Cockpit                 |      |
| Optional    | ASET Mk1 Lander Can              | Stock                 | Done    | High tech Mk1 Lander                         |      |
| Optional    | ASET Mk1-2 Command Pod           | Stock                 | Done    | High tech Mk1-3 Command Pod                  |      |
| Optional    | Warbird Cockpits                 | Stock, SXT,           | Partial | Analog avaition cockpits for several mods    |      |
|             |                                  | AirplanePlus,         |         |                                              |      |
|             |                                  | Kerbonov              |         |                                              |      |
| Optional    | Ultimate Shuttle IVA             | Stock                 | Planned | Retro and modern MK3 Cockpit IVA (2)         |      |
| Optional    | Probe Control Room               | PBC                   | Planned | Probe control room for probes                |      |
| Optional    | ALCOR by ASET                    | Alcor                 | Planned | High tech 3-man lander capsule               |      |
| Optional    | OPT Spaceplane                   | Opt                   | Planned | Near and Far Future Spacecraft               |      |
| Optional    | Vexarp IVA                       | NFSpacecraft          | Planned | Near Future Spacecraft improved IVA          |      |
| Optional    | Tundra Exploration               | TundraExploration     |         | With MAS has improved alternatives (?)       |      |
| Optional    | Kerbal Flying Saucers            | KerbalFlyingSaucers   |         | With MAS has improved alternatives (?)       |      |
| Optional    | Kermantech                       | Stock                 |         | Mk3 Shuttle IVA                              |      |
| Optional    | Apex                             | Stock                 |         | Mk3 Shuttle IVA                              |      |
| Optional    | MOARdvPlus                       | BDB                   |         | With MAS, three BDB Kane/Sarnus IVA (Apollo) |      |
| Optional    | NiceMK (?)                       | NiceMK (?)            |         | ?                                            |      |
| Optional    | Falcon (?)                       | AirplanePlus (?)      |         | ?                                            |      |
| Optional    | ColdwarAerospace (?)             | ColdwareAerospace (?) |         | ?                                            |      |

- (1) :: You can have either RPM or MAS, or in fact both at the same time. MAS includes upgrade
scripts that render some existing RPM IVAs at a high quality and performance (in my
experience).

- (2) :: Only copy UltimateShuttleIVA into GameData, ignore the top level USIVA-xxx.cfg files.

* User Manual

Once you have installed all the mods needed, once you've restarted the game, right
clicking on supported command modules will show the PAW UI with a group called "IVA
Switch".

When in the SPH or VAB editor this will show one or more coloured box images representing
each available IVA, plus a "Select IVA" button below that if clicked displays a drop down
menu with all the possible IVA options.

When in-flight, only the "Select IVA" menu button is available: you also need to exit any
in-IVA view (press C). When changing the IVA you should see the Kerbal portraits
temporarily go to noise for a moment. You can then re-enter the IVA view with the same
crew present (hopefully, if one gets lost or changes seats, that's the price you pay for
such fast in-flight reconstruction).

With only the required mods, it's likely you'll only see a "Stock" selection on stock command
modules, which is the vanilla IVA modules. These are always the default when adding a new
stock command module, or loading a vessel for the first time after installing the mod
(yes, it will revert any existing IVA mods to stock or default setting for that mod).

For Stock and Missing History, it's best to install the "Recommended" mods shown in the
above table: these provide three or four different IVA variants (low, medium and high
tech, sometimes with an alternative high tech variant of higher quality).

You can save the selection for the ship design in the SPH/VAB editor, in which case each launch
will use that IVA selection as the new default.

For already in-flight vessels, you can change the selection (while not in the IVA), and it
will be saved along with that ship only, this includes when the ship goes on rails
(switching away to another vessel), and when saving the game.

* Support

Either respond in the forum or on GitHub. If it's a bug, you should always provide logs
with the bug report, otherwise it's even more unlikely that the author will respond or be
able to help.

* Support Progress

The following table lists the current progression on supporting mods and IVA mods.

Note: DE+MAS is an Reviva specialized combination of DE_IVAExtension where one or two MFDs
are replaced by the superb MAS_ALCOR_MFD2 which simulates a near future avionics upgrade.


| Name               | CFG Name            | From         | IVA             | Tech   | Support Status |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk1 Cockpit        | Mark1Cockpit        | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | ASET            | High   | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk1 Command Pod    | mk1pod_v2           | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | Warbirds        | Med    | Done           |
|                    |                     |              | MAS             | Low    | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk1 Inline Cockpit | Mark2Cockpit        | Stock        | Stock           | Low    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | Warbirds        | Medium | Done           |
|                    |                     |              | WarbirdsSI      | Medium | Done (1)       |
|                    |                     |              | WarbirdsRetro   | Low    | Done           |
|                    |                     |              | WarbirdsRetroSI | Low    | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk1 Lander Can     | landerCabinSmall    | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | ASET            | Low    | Done           |
|                    |                     |              | MAS             | Low    | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk1-3 Command Pod  | mk1-3pod            | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | ASET            | High   | Done           |
|                    |                     |              | MAS             | Low    | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk2 Cockpit        | mk2Cockpit_Standard | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk2 Inline Cockpit | mk2Cockpit_Inline   | Stock        | Stock           | Low    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | WarbirdsSI      | High   | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk2 Lander Can     | mk2LanderCabin_v2   | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk3 Cockpit        | mk3Cockpit_Shuttle  | Stock        | Stock           | Low    | Done           |
|                    |                     |              | RPM             | Med    | Done           |
|                    |                     |              | DE_IVAExtension | High   | Done           |
|                    |                     |              | UltimateRetro   | Med    | Done (2)       |
|                    |                     |              | UltimateGlass   | High   | Done           |
|                    |                     |              | DE+MAS          | Near   | Done           |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| PPD-12 Cupola      | cupola              | Stock        | Stock           | Low    |                |
|                    |                     |              | RPM             | Med    |                |
|                    |                     |              | DE_IVAExtension | High   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| KV-1               | kv1Pod              | MH           | MH              | Low    |                |
|                    |                     |              | ASET for MH     | High   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| KV-2               | kv2Pod              | MH           | MH              | Low    |                |
|                    |                     |              | ASET for MH     | High   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| KV-3               | kv3Pod              | MH           | MH              | Low    |                |
|                    |                     |              | ASET for MH     | High   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Mk2 Command Pod    | Mk2Pod              | MH           | MH              | Low    |                |
|                    |                     |              | ASET for MH     | High   |                |
|                    |                     |              | MH+MAS          | Near   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| M.E.M.             | MEMLander           | MH           | MH              | Low    |                |
|                    |                     |              | ASET for MH     | High   |                |
|                    |                     |              | MH+MAS          | Near   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Probe Control Room |                     | PCR          | PCR             | Med    |                |
|                    |                     |              | DE_IVAExtension | High   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|
| Alcor              |                     | Alcor        | Alcor           | High   |                |
|                    |                     |              | Alcor+MAS       | Near   |                |
|--------------------+---------------------+--------------+-----------------+--------+----------------|

- (1) :: Mk1 Inline WarbirdsSI variant display "INITIALIZATION ERROR", but seems benign.
  Will eventually try to fix.
- (2) :: Mk3 Ultimate Retro variant CRT do not seem to work. Will eventually try to fix.

* Building

If you want to build the DLL and packages, just be aware that the provided source assume
use of Unix make and mono.

I personally work on Ubuntu 20.04 (running on WSL2 in Windows 10). You will need to
install mono-complete and know how to use make and Unix. If not, it's likely you could
generate a Visual Studio project and fill in some sensible details.

The Makefile "build" target will build the DLL.

The "install" target will copy the DLL and GameData to the KSP directory specified in the
Makefile, you should modify that (the default Steam install on WSL2 on Windows is
commented out).

Happy to recieve pull requests on GitHub for improvements, more IVA support, etc.

